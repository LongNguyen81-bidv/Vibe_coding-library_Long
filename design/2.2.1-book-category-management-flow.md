# 2.2.1 - Luồng Quản Lý Thể Loại Sách

## Thông tin chung
- **Mã tính năng:** 2.2.1
- **Actor:** Nhân viên thư viện (Librarian)
- **Yêu cầu:** Đăng nhập với vai trò Nhân viên thư viện (2.1.2)
- **Mục đích:** Quản lý danh mục thể loại sách trong hệ thống

## Flowchart - Tổng quan

```mermaid
flowchart TD
    Start([Bắt đầu]) --> A[Nhân viên đăng nhập]
    A --> B[Truy cập menu<br/>"Quản lý thể loại sách"]
    B --> C[Hiển thị bảng danh sách<br/>thể loại sách]
    
    C --> D{Nhân viên muốn<br/>làm gì?}
    
    D -->|Thêm mới| E[Luồng Thêm thể loại]
    D -->|Sửa| F[Luồng Sửa thể loại]
    D -->|Xóa| G[Luồng Xóa thể loại]
    D -->|Không làm gì| End([Kết thúc])
    
    E --> C
    F --> C
    G --> C
```

## Flowchart - Thêm thể loại sách

```mermaid
flowchart TD
    Start([Bắt đầu]) --> A[Click "Thêm thể loại sách"]
    A --> B[Hiển thị form/modal<br/>thêm mới]
    B --> C[Nhập tên thể loại]
    C --> D[Click "Lưu"]
    D --> E{Validate dữ liệu}
    
    E -->|Tên trống| F[Hiển thị lỗi:<br/>"Tên thể loại không được<br/>để trống"]
    E -->|Tên > 50 ký tự| G[Hiển thị lỗi:<br/>"Tên thể loại không được<br/>vượt quá 50 ký tự"]
    
    F --> C
    G --> C
    
    E -->|Hợp lệ| H{Kiểm tra trùng tên<br/>trong database}
    
    H -->|Đã tồn tại| I[Hiển thị lỗi:<br/>"Thể loại này đã tồn tại"]
    I --> C
    
    H -->|Chưa tồn tại| J[Lưu vào database]
    J --> K[Hiển thị thông báo:<br/>"Thêm thể loại thành công!"]
    K --> L[Cập nhật bảng<br/>danh sách]
    L --> End([Kết thúc])
```

## Flowchart - Sửa thể loại sách

```mermaid
flowchart TD
    Start([Bắt đầu]) --> A[Click vào ô tên thể loại<br/>trên bảng để sửa]
    A --> B[Ô chuyển thành<br/>input có thể chỉnh sửa]
    B --> C[Nhập tên mới]
    C --> D[Nhấn Enter hoặc<br/>click ra ngoài để lưu]
    D --> E{Validate dữ liệu}
    
    E -->|Tên trống| F[Hiển thị lỗi:<br/>"Tên thể loại không được<br/>để trống"]
    E -->|Tên > 50 ký tự| G[Hiển thị lỗi:<br/>"Tên thể loại không được<br/>vượt quá 50 ký tự"]
    
    F --> C
    G --> C
    
    E -->|Hợp lệ| H{Kiểm tra trùng tên<br/>với thể loại khác}
    
    H -->|Đã tồn tại| I[Hiển thị lỗi:<br/>"Thể loại này đã tồn tại"]
    I --> C
    
    H -->|Không trùng| J[Cập nhật database]
    J --> K[Hiển thị thông báo:<br/>"Cập nhật thành công!"]
    K --> End([Kết thúc])
```

## Flowchart - Xóa thể loại sách

```mermaid
flowchart TD
    Start([Bắt đầu]) --> A[Click nút "Xóa"<br/>trên dòng thể loại]
    A --> B{Kiểm tra có sách<br/>thuộc thể loại này?}
    
    B -->|Có sách| C[Hiển thị lỗi:<br/>"Không thể xóa thể loại<br/>đang có sách thuộc về"]
    C --> End([Kết thúc])
    
    B -->|Không có sách| D[Hiển thị modal xác nhận:<br/>"Bạn có chắc muốn xóa<br/>thể loại này?"]
    D --> E{Người dùng<br/>xác nhận?}
    
    E -->|Hủy| End
    E -->|Xác nhận| F[Xóa khỏi database]
    F --> G[Hiển thị thông báo:<br/>"Xóa thể loại thành công!"]
    G --> H[Cập nhật bảng<br/>danh sách]
    H --> End
```

## Validation Rules

| Trường | Quy tắc | Thông báo lỗi |
|--------|---------|---------------|
| Tên thể loại | Không được trống | "Tên thể loại không được để trống" |
| Tên thể loại | Tối đa 50 ký tự | "Tên thể loại không được vượt quá 50 ký tự" |
| Tên thể loại | Không được trùng | "Thể loại này đã tồn tại" |

## Điều kiện xóa

| Điều kiện | Cho phép xóa | Thông báo |
|-----------|--------------|-----------|
| Không có sách thuộc thể loại | ✅ | - |
| Có sách thuộc thể loại | ❌ | "Không thể xóa thể loại đang có sách thuộc về" |

## Ghi chú
- Sửa trực tiếp trên bảng (inline editing) để tăng trải nghiệm người dùng
- Xóa cần xác nhận 2 bước để tránh xóa nhầm
- Nếu thể loại có sách, cần di chuyển/xóa sách trước khi xóa thể loại

