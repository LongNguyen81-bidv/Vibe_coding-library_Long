# 2.1.3 - Luồng Hồ Sơ Cá Nhân

## Thông tin chung
- **Mã tính năng:** 2.1.3
- **Actor:** Độc giả (Reader)
- **Yêu cầu:** Đăng nhập với vai trò Độc giả (2.1.2)
- **Mục đích:** Xem và cập nhật thông tin cá nhân, đổi mật khẩu

## Flowchart - Xem & Cập nhật thông tin

```mermaid
flowchart TD
    Start([Bắt đầu]) --> A[Độc giả đăng nhập]
    A --> B[Click "Hồ sơ cá nhân"<br/>trên menu]
    B --> C[Hiển thị trang Hồ sơ]
    C --> D[Hiển thị thông tin:<br/>- Tên, Email<br/>- Số điện thoại, Địa chỉ<br/>- Ngày tham gia<br/>- Số lần mượn<br/>- Tổng tiền phạt]
    
    D --> E{Người dùng muốn<br/>làm gì?}
    
    E -->|Cập nhật thông tin| F[Click "Chỉnh sửa"]
    E -->|Đổi mật khẩu| G[Click "Đổi mật khẩu"]
    E -->|Không làm gì| End([Kết thúc])
    
    F --> H[Form chỉnh sửa:<br/>- Tên<br/>- Số điện thoại<br/>- Địa chỉ]
    H --> I[Nhập thông tin mới]
    I --> J[Click "Lưu"]
    J --> K{Validate dữ liệu}
    
    K -->|Tên trống hoặc > 50 ký tự| L[Hiển thị lỗi tên]
    K -->|SĐT không hợp lệ| M[Hiển thị lỗi SĐT]
    K -->|Địa chỉ trống hoặc > 255 ký tự| N[Hiển thị lỗi địa chỉ]
    
    L --> I
    M --> I
    N --> I
    
    K -->|Hợp lệ| O[Cập nhật database]
    O --> P[Hiển thị thông báo:<br/>"Cập nhật thành công!"]
    P --> D
    
    G --> Q[Hiển thị form đổi mật khẩu]
    Q --> R[Nhập:<br/>- Mật khẩu hiện tại<br/>- Mật khẩu mới<br/>- Xác nhận mật khẩu mới]
    R --> S[Click "Đổi mật khẩu"]
    S --> T{Validate mật khẩu}
    
    T -->|MK hiện tại sai| U[Hiển thị lỗi:<br/>"Mật khẩu hiện tại<br/>không đúng"]
    T -->|MK mới < 8 hoặc > 16| V[Hiển thị lỗi:<br/>"Mật khẩu mới phải<br/>từ 8-16 ký tự"]
    T -->|MK xác nhận không khớp| W[Hiển thị lỗi:<br/>"Mật khẩu xác nhận<br/>không khớp"]
    
    U --> R
    V --> R
    W --> R
    
    T -->|Hợp lệ| X[Hash mật khẩu mới<br/>Cập nhật database]
    X --> Y[Hiển thị thông báo:<br/>"Đổi mật khẩu thành công!"]
    Y --> D
```

## Thông tin hiển thị

| Trường | Mô tả | Có thể sửa |
|--------|-------|------------|
| Tên | Tên người dùng | ✅ |
| Email | Email đăng ký | ❌ |
| Số điện thoại | Số điện thoại liên hệ | ✅ |
| Địa chỉ | Địa chỉ liên hệ | ✅ |
| Ngày tham gia | Ngày đăng ký tài khoản | ❌ |
| Số lần mượn | Tổng số lượt mượn sách | ❌ |
| Tổng tiền phạt | Tổng số tiền phạt đã có | ❌ |

## Validation Rules - Cập nhật thông tin

| Trường | Quy tắc | Thông báo lỗi |
|--------|---------|---------------|
| Tên | Không được trống | "Tên không được để trống" |
| Tên | Tối đa 50 ký tự | "Tên không được vượt quá 50 ký tự" |
| Số điện thoại | Định dạng VN hợp lệ | "Số điện thoại không hợp lệ" |
| Địa chỉ | Không được trống | "Địa chỉ không được để trống" |
| Địa chỉ | Tối đa 255 ký tự | "Địa chỉ không được vượt quá 255 ký tự" |

## Validation Rules - Đổi mật khẩu

| Trường | Quy tắc | Thông báo lỗi |
|--------|---------|---------------|
| Mật khẩu hiện tại | Phải đúng với DB | "Mật khẩu hiện tại không đúng" |
| Mật khẩu mới | Tối thiểu 8 ký tự | "Mật khẩu mới phải có ít nhất 8 ký tự" |
| Mật khẩu mới | Tối đa 16 ký tự | "Mật khẩu mới không được vượt quá 16 ký tự" |
| Xác nhận mật khẩu | Phải trùng MK mới | "Mật khẩu xác nhận không khớp" |

## Ghi chú
- Email không thể thay đổi vì là định danh tài khoản
- Các thông tin thống kê (số lần mượn, tiền phạt) được tính tự động từ database
- Sau khi đổi mật khẩu, không cần đăng xuất (token vẫn còn hiệu lực)

