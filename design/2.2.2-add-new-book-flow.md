# 2.2.2 - Luồng Thêm Sách Mới

## Thông tin chung
- **Mã tính năng:** 2.2.2
- **Actor:** Nhân viên thư viện (Librarian)
- **Yêu cầu:** 
  - Đăng nhập với vai trò Nhân viên thư viện (2.1.2)
  - Đã có ít nhất một thể loại sách (2.2.1)
- **Mục đích:** Thêm sách mới vào kho thư viện

## Flowchart

```mermaid
flowchart TD
    Start([Bắt đầu]) --> A[Nhân viên đăng nhập]
    A --> B[Truy cập menu<br/>"Quản lý sách"]
    B --> C[Click "Thêm Sách Mới"]
    C --> D[Hiển thị form<br/>thêm sách]
    
    D --> E[Nhập thông tin sách:<br/>- Tên sách<br/>- Tác giả<br/>- Năm xuất bản<br/>- ISBN<br/>- Thể loại<br/>- Mô tả<br/>- Số lượng bản sách]
    
    E --> F[Click "Thêm sách"]
    F --> G{Validate dữ liệu}
    
    G -->|Tên sách trống<br/>hoặc > 100 ký tự| H[Lỗi: Tên sách<br/>không hợp lệ]
    G -->|Tác giả trống<br/>hoặc > 100 ký tự| I[Lỗi: Tác giả<br/>không hợp lệ]
    G -->|Năm XB không hợp lệ<br/>< 1900 hoặc > năm hiện tại| J[Lỗi: Năm xuất bản<br/>không hợp lệ]
    G -->|ISBN sai định dạng| K[Lỗi: ISBN<br/>không đúng định dạng]
    G -->|Chưa chọn thể loại| L[Lỗi: Vui lòng<br/>chọn thể loại]
    G -->|Mô tả trống<br/>hoặc > 255 ký tự| M[Lỗi: Mô tả<br/>không hợp lệ]
    G -->|Số lượng <= 0<br/>hoặc không phải số| N[Lỗi: Số lượng<br/>phải > 0]
    
    H --> E
    I --> E
    J --> E
    K --> E
    L --> E
    M --> E
    N --> E
    
    G -->|Hợp lệ| O{ISBN đã tồn tại<br/>trong database?}
    
    O -->|Đã tồn tại| P[Lỗi: ISBN này<br/>đã được sử dụng]
    P --> E
    
    O -->|Chưa tồn tại| Q[Lưu sách vào database<br/>- Trạng thái: "Có sẵn"<br/>- Số lượng có sẵn = Số lượng nhập<br/>- Số lượng đang mượn = 0]
    
    Q --> R[Hiển thị thông báo:<br/>"Thêm sách thành công!"]
    R --> S{Tiếp tục thêm sách?}
    
    S -->|Có| D
    S -->|Không| T[Chuyển đến<br/>Danh sách sách]
    T --> End([Kết thúc])
```

## Thông tin sách cần nhập

| Trường | Bắt buộc | Mô tả |
|--------|----------|-------|
| Tên sách | ✅ | Tiêu đề của sách |
| Tác giả | ✅ | Tên tác giả |
| Năm xuất bản | ✅ | Năm sách được xuất bản |
| ISBN | ❌ | Mã định danh sách (nếu có) |
| Thể loại | ✅ | Dropdown chọn từ danh sách thể loại |
| Mô tả | ✅ | Mô tả ngắn về nội dung sách |
| Số lượng | ✅ | Số bản sách nhập vào |

## Validation Rules

| Trường | Quy tắc | Thông báo lỗi |
|--------|---------|---------------|
| Tên sách | Không được trống | "Tên sách không được để trống" |
| Tên sách | Tối đa 100 ký tự | "Tên sách không được vượt quá 100 ký tự" |
| Tác giả | Không được trống | "Tác giả không được để trống" |
| Tác giả | Tối đa 100 ký tự | "Tác giả không được vượt quá 100 ký tự" |
| Năm xuất bản | >= 1900 | "Năm xuất bản không hợp lệ" |
| Năm xuất bản | <= Năm hiện tại | "Năm xuất bản không thể ở tương lai" |
| ISBN | Định dạng ISBN-10 hoặc ISBN-13 | "ISBN không đúng định dạng" |
| ISBN | Unique trong DB | "ISBN này đã được sử dụng" |
| Thể loại | Phải chọn | "Vui lòng chọn thể loại sách" |
| Mô tả | Không được trống | "Mô tả không được để trống" |
| Mô tả | Tối đa 255 ký tự | "Mô tả không được vượt quá 255 ký tự" |
| Số lượng | Phải là số | "Số lượng phải là số" |
| Số lượng | > 0 | "Số lượng phải lớn hơn 0" |

## ISBN Format

```
ISBN-10: X-XXX-XXXXX-X hoặc XXXXXXXXXX
ISBN-13: XXX-X-XXX-XXXXX-X hoặc XXXXXXXXXXXXX
```

## Trạng thái sách sau khi thêm

| Thuộc tính | Giá trị |
|------------|---------|
| Trạng thái | "Có sẵn" (Available) |
| Số lượng có sẵn | = Số lượng nhập |
| Số lượng đang mượn | 0 |

## Ghi chú
- ISBN là trường tùy chọn vì một số sách cũ có thể không có ISBN
- Nếu có ISBN, phải đảm bảo unique để tránh nhập trùng sách
- Thể loại phải được tạo trước (2.2.1) mới có thể chọn

