# 2.5.2 - Lu·ªìng Xem & Thanh To√°n Kho·∫£n Ph·∫°t (ƒê·ªôc Gi·∫£)

## Th√¥ng tin chung
- **M√£ t√≠nh nƒÉng:** 2.5.2
- **Actor:** ƒê·ªôc gi·∫£ (Reader)
- **Y√™u c·∫ßu:** 
  - ƒêƒÉng nh·∫≠p v·ªõi vai tr√≤ ƒê·ªôc gi·∫£ (2.1.2)
  - C√≥ phi·∫øu ph·∫°t ch∆∞a thanh to√°n (2.4.2)
  - C√≥ m·ª©c ph·∫°t trong h·ªá th·ªëng (2.5.1)
- **M·ª•c ƒë√≠ch:** Cho ph√©p ƒë·ªôc gi·∫£ xem v√† thanh to√°n c√°c kho·∫£n ph·∫°t

## Flowchart - Xem danh s√°ch kho·∫£n ph·∫°t

```mermaid
flowchart TD
    Start([B·∫Øt ƒë·∫ßu]) --> A[ƒê·ªôc gi·∫£ ƒëƒÉng nh·∫≠p]
    A --> B[Truy c·∫≠p menu<br/>"Kho·∫£n ph·∫°t c·ªßa t√¥i"]
    B --> C[G·ªçi API l·∫•y danh s√°ch<br/>phi·∫øu ph·∫°t]
    C --> D[Hi·ªÉn th·ªã danh s√°ch<br/>kho·∫£n ph·∫°t]
    
    D --> E{C√≥ kho·∫£n ph·∫°t?}
    E -->|Kh√¥ng| F[Hi·ªÉn th·ªã:<br/>"B·∫°n kh√¥ng c√≥<br/>kho·∫£n ph·∫°t n√†o"]
    F --> End([K·∫øt th√∫c])
    
    E -->|C√≥| G[Hi·ªÉn th·ªã b·∫£ng v·ªõi:<br/>- Nguy√™n nh√¢n ph·∫°t<br/>- S·ªë ti·ªÅn<br/>- Ng√†y ph·∫°t<br/>- Tr·∫°ng th√°i]
    
    G --> H{ƒê·ªôc gi·∫£ mu·ªën<br/>l√†m g√¨?}
    
    H -->|Thanh to√°n| I[Lu·ªìng Thanh to√°n]
    H -->|Xem chi ti·∫øt| J[Hi·ªÉn th·ªã modal<br/>chi ti·∫øt phi·∫øu ph·∫°t]
    H -->|Kh√¥ng l√†m g√¨| End
    
    I --> G
    J --> G
```

## Flowchart - Thanh to√°n kho·∫£n ph·∫°t

```mermaid
flowchart TD
    Start([Thanh to√°n]) --> A{Phi·∫øu ph·∫°t<br/>·ªü tr·∫°ng th√°i n√†o?}
    
    A -->|ƒê√£ thanh to√°n| B[Kh√¥ng hi·ªÉn th·ªã<br/>n√∫t thanh to√°n]
    B --> End([K·∫øt th√∫c])
    
    A -->|Ch·ªù x√°c nh·∫≠n| C[Hi·ªÉn th·ªã:<br/>"ƒêang ch·ªù x√°c nh·∫≠n<br/>thanh to√°n"]
    C --> End
    
    A -->|T·ª´ ch·ªëi| D[Hi·ªÉn th·ªã n√∫t<br/>"Thanh to√°n l·∫°i"]
    D --> E[Click "Thanh to√°n l·∫°i"]
    E --> F[Lu·ªìng thanh to√°n]
    
    A -->|Ch∆∞a thanh to√°n| G[Ch·ªçn phi·∫øu ph·∫°t<br/>mu·ªën thanh to√°n]
    G --> H[Click "Thanh to√°n"]
    H --> F
    
    F --> I[Hi·ªÉn th·ªã modal<br/>th√¥ng tin thanh to√°n:<br/>- S·ªë ti·ªÅn c·∫ßn thanh to√°n<br/>- Th√¥ng tin chuy·ªÉn kho·∫£n<br/>- S·ªë t√†i kho·∫£n ng√¢n h√†ng<br/>- N·ªôi dung chuy·ªÉn kho·∫£n]
    
    I --> J[ƒê·ªôc gi·∫£ th·ª±c hi·ªán<br/>chuy·ªÉn kho·∫£n qua<br/>ng√¢n h√†ng]
    J --> K[Click "ƒê√£ thanh to√°n"]
    K --> L[Hi·ªÉn th·ªã form x√°c nh·∫≠n:<br/>- Upload ·∫£nh ch·ª©ng t·ª´<br/>ho·∫∑c nh·∫≠p m√£ giao d·ªãch]
    L --> M{ƒê√£ nh·∫≠p<br/>th√¥ng tin?}
    
    M -->|Ch∆∞a| N[Hi·ªÉn th·ªã l·ªói:<br/>"Vui l√≤ng cung c·∫•p<br/>th√¥ng tin thanh to√°n"]
    N --> L
    
    M -->|R·ªìi| O[C·∫≠p nh·∫≠t phi·∫øu ph·∫°t:<br/>- Tr·∫°ng th√°i: "Ch·ªù x√°c nh·∫≠n"<br/>- paymentProof = th√¥ng tin TT]
    O --> P[Hi·ªÉn th·ªã th√¥ng b√°o:<br/>"ƒê√£ g·ª≠i y√™u c·∫ßu x√°c nh·∫≠n!<br/>Vui l√≤ng ch·ªù nh√¢n vi√™n<br/>x√°c nh·∫≠n thanh to√°n."]
    P --> End
```

## Th√¥ng tin hi·ªÉn th·ªã

| Tr∆∞·ªùng | M√¥ t·∫£ |
|--------|-------|
| M√£ phi·∫øu ph·∫°t | ID phi·∫øu ph·∫°t |
| T√™n s√°ch | S√°ch li√™n quan ƒë·∫øn ph·∫°t |
| Nguy√™n nh√¢n | Tr·∫£ mu·ªôn / H∆∞ h·ªèng / M·∫•t s√°ch |
| S·ªë ti·ªÅn | S·ªë ti·ªÅn ph·∫£i tr·∫£ (VNƒê) |
| Ng√†y ph·∫°t | Ng√†y t·∫°o phi·∫øu ph·∫°t |
| Tr·∫°ng th√°i | Ch∆∞a TT / Ch·ªù x√°c nh·∫≠n / T·ª´ ch·ªëi / ƒê√£ TT |
| H√†nh ƒë·ªông | Thanh to√°n / Xem l√Ω do t·ª´ ch·ªëi |

## C√°c tr·∫°ng th√°i phi·∫øu ph·∫°t

| Tr·∫°ng th√°i | M√£ | M√¥ t·∫£ | Hi·ªÉn th·ªã |
|------------|-----|-------|----------|
| Ch∆∞a thanh to√°n | UNPAID | Ch∆∞a th·ª±c hi·ªán thanh to√°n | üî¥ ƒê·ªè |
| Ch·ªù x√°c nh·∫≠n | PENDING | ƒê√£ TT, ch·ªù NV x√°c nh·∫≠n | üü° V√†ng |
| T·ª´ ch·ªëi | REJECTED | NV t·ª´ ch·ªëi x√°c nh·∫≠n | üü† Cam |
| ƒê√£ thanh to√°n | PAID | ƒê√£ ƒë∆∞·ª£c x√°c nh·∫≠n TT | üü¢ Xanh |

## Th√¥ng tin chuy·ªÉn kho·∫£n

```
Ng√¢n h√†ng: [T√™n ng√¢n h√†ng th∆∞ vi·ªán]
S·ªë t√†i kho·∫£n: [S·ªë t√†i kho·∫£n]
Ch·ªß t√†i kho·∫£n: [T√™n ch·ªß TK]
S·ªë ti·ªÅn: [S·ªë ti·ªÅn ph·∫°t] VNƒê
N·ªôi dung: [M√£ phi·∫øu ph·∫°t] - [T√™n ƒë·ªôc gi·∫£]
```

## D·ªØ li·ªáu phi·∫øu ph·∫°t

```json
{
  "id": "uuid",
  "readerId": "uuid",
  "borrowingId": "uuid",
  "bookId": "uuid",
  "fineLevelId": "uuid",
  "reason": "LATE_RETURN",
  "amount": 50000,
  "fineDate": "2024-01-20",
  "status": "UNPAID",
  "paymentProof": null,
  "rejectionReason": null,
  "note": "Tr·∫£ mu·ªôn 10 ng√†y",
  "createdAt": "2024-01-20T10:00:00Z"
}
```

## Quy t·∫Øc nghi·ªáp v·ª•

1. **Ph∆∞∆°ng th·ª©c thanh to√°n:** Ch·ªâ h·ªó tr·ª£ chuy·ªÉn kho·∫£n ng√¢n h√†ng
2. **X√°c nh·∫≠n thanh to√°n:** Sau khi chuy·ªÉn kho·∫£n, ƒë·ªôc gi·∫£ c·∫ßn cung c·∫•p b·∫±ng ch·ª©ng (·∫£nh/m√£ GD)
3. **Ch·ªù duy·ªát:** Nh√¢n vi√™n s·∫Ω ki·ªÉm tra v√† x√°c nh·∫≠n thanh to√°n
4. **B·ªã t·ª´ ch·ªëi:** N·∫øu b·ªã t·ª´ ch·ªëi, ƒë·ªôc gi·∫£ c√≥ th·ªÉ thanh to√°n l·∫°i

## Ghi ch√∫
- ƒê·ªôc gi·∫£ kh√¥ng th·ªÉ m∆∞·ª£n s√°ch m·ªõi n·∫øu c√≥ phi·∫øu ph·∫°t "Ch∆∞a thanh to√°n"
- Tr·∫°ng th√°i "Ch·ªù x√°c nh·∫≠n" v·∫´n ƒë∆∞·ª£c t√≠nh l√† ch∆∞a thanh to√°n (kh√¥ng cho m∆∞·ª£n s√°ch)
- Khi b·ªã t·ª´ ch·ªëi, hi·ªÉn th·ªã l√Ω do ƒë·ªÉ ƒë·ªôc gi·∫£ bi·∫øt v√† thanh to√°n l·∫°i

