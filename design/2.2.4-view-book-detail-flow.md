# 2.2.4 - Luồng Xem Chi Tiết Sách

## Thông tin chung
- **Mã tính năng:** 2.2.4
- **Actor:** Tất cả người dùng (không cần đăng nhập)
- **Yêu cầu:** Có sách trong hệ thống (2.2.3)
- **Mục đích:** Hiển thị thông tin chi tiết của một cuốn sách

## Flowchart - Xem chi tiết sách

```mermaid
flowchart TD
    Start([Bắt đầu]) --> A[Người dùng click vào<br/>một sách trong danh sách]
    A --> B[Chuyển đến trang<br/>Chi tiết sách]
    B --> C[Gọi API lấy<br/>thông tin sách theo ID]
    C --> D{Sách tồn tại?}
    
    D -->|Không| E[Hiển thị trang 404:<br/>"Không tìm thấy sách"]
    E --> End([Kết thúc])
    
    D -->|Có| F[Hiển thị thông tin sách:<br/>- Tên, Tác giả, ISBN<br/>- Năm XB, Mô tả<br/>- Số lượng có sẵn<br/>- Số lượng đang mượn]
    
    F --> G{Người dùng là<br/>Nhân viên thư viện?}
    
    G -->|Có| H[Hiển thị thêm:<br/>Lịch sử mượn sách<br/>- Độc giả<br/>- Ngày mượn<br/>- Ngày hết hạn]
    G -->|Không| I[Không hiển thị<br/>lịch sử mượn]
    
    H --> J{Người dùng muốn<br/>làm gì?}
    I --> J
    
    J -->|Mượn sách<br/>Độc giả đã đăng nhập| K[Chuyển đến 2.3.1<br/>Luồng Mượn Sách]
    J -->|Sửa sách<br/>Nhân viên| L[Chuyển đến 2.2.5<br/>Luồng Sửa Sách]
    J -->|Xóa sách<br/>Nhân viên| M[Chuyển đến 2.2.5<br/>Luồng Xóa Sách]
    J -->|Quay lại| N[Quay lại<br/>Danh sách sách]
    
    K --> End
    L --> End
    M --> End
    N --> End
```

## Flowchart - Điều kiện hiển thị nút Mượn sách

```mermaid
flowchart TD
    Start([Kiểm tra hiển thị<br/>nút "Mượn sách"]) --> A{Người dùng<br/>đã đăng nhập?}
    
    A -->|Chưa| B[Hiển thị nút:<br/>"Đăng nhập để mượn sách"]
    A -->|Rồi| C{Vai trò là<br/>Độc giả?}
    
    C -->|Không<br/>Librarian/Admin| D[Không hiển thị<br/>nút mượn sách]
    C -->|Có| E{Sách còn<br/>có sẵn?}
    
    E -->|Không<br/>Số lượng = 0| F[Hiển thị:<br/>"Sách đã hết"]
    E -->|Có| G[Hiển thị nút:<br/>"Mượn sách"]
    
    B --> End([Kết thúc])
    D --> End
    F --> End
    G --> End
```

## Thông tin hiển thị

### Thông tin cơ bản (Tất cả người dùng)

| Trường | Mô tả |
|--------|-------|
| Tên sách | Tiêu đề sách |
| Tác giả | Tên tác giả |
| ISBN | Mã định danh (nếu có) |
| Năm xuất bản | Năm sách được xuất bản |
| Thể loại | Tên thể loại sách |
| Mô tả | Mô tả chi tiết về sách |
| Số lượng có sẵn | Số sách còn trong kho |
| Số lượng đang mượn | Số sách đang được độc giả mượn |

### Lịch sử mượn sách (Chỉ Nhân viên thư viện)

| Trường | Mô tả |
|--------|-------|
| Tên độc giả | Người đang/đã mượn |
| Ngày mượn | Ngày tạo đơn mượn |
| Ngày hết hạn | Ngày phải trả sách |
| Trạng thái | Đang mượn / Đã trả / Quá hạn |

## Các nút hành động theo vai trò

| Vai trò | Nút hiển thị |
|---------|--------------|
| Guest (chưa đăng nhập) | "Đăng nhập để mượn sách" |
| Reader (Độc giả) | "Mượn sách" (nếu còn sách) |
| Librarian (Nhân viên) | "Sửa", "Xóa" |
| Admin | "Sửa", "Xóa" |

## API Response Example

```json
{
  "id": "uuid",
  "name": "Tên sách",
  "author": "Tác giả",
  "isbn": "978-3-16-148410-0",
  "publishYear": 2023,
  "category": {
    "id": "uuid",
    "name": "Văn học"
  },
  "description": "Mô tả chi tiết...",
  "availableQuantity": 5,
  "borrowedQuantity": 2,
  "borrowHistory": [
    {
      "readerId": "uuid",
      "readerName": "Nguyễn Văn A",
      "borrowDate": "2024-01-01",
      "dueDate": "2024-01-15",
      "status": "BORROWED"
    }
  ]
}
```

## Ghi chú
- Lịch sử mượn chỉ hiển thị cho Nhân viên thư viện để bảo vệ quyền riêng tư độc giả
- Nút "Mượn sách" được điều kiện hóa dựa trên vai trò và số lượng sách
- Nếu sách hết, hiển thị trạng thái "Sách đã hết" thay vì nút mượn

